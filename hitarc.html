<!DOCTYPE HTML>
<html>
    <head>
	<script type="text/javascript" src="jquery.js"></script>
    </head>
    <body onload="init()">

	<canvas id="canvas" width="500" height="500" style="border: 1px solid #CCCCCC;">
	This text is displayed if your browser does not support HTML5 Canvas.
	</canvas>

	<script type="text/javascript">

// forked from edo_m18's "Hit test with arc on canvas." http://jsdo.it/edo_m18/1WF2
var canvas = document.getElementById('canvas'),
    ctx = canvas.getContext('2d');
var px = {
    cx: canvas.width/2,
    cy: canvas.height/2,
    w: canvas.width,
    h: canvas.height
};
var flg = false;
var m1, m2;
function _draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    _arc();
}

function _arc() {
    var r = 100,
        sr = -1 * Math.PI / 180,
        er = 40 * Math.PI / 180,
        d  = 0;//40 * Math.PI / 180;
    
    ctx.beginPath();
    ctx.save();
    ctx.fillStyle = (flg) ? 'blue' : 'red';
    ctx.translate(px.cx, px.cy);
    ctx.save();
    //ctx.rotate(d);
    ctx.moveTo(0,0);
    ctx.arc(0, 0, r, sr, er);
    ctx.fill();
    
    //斜辺の式をｍ求める
    m1 = Math.sin(sr+d) / Math.cos(sr+d);
    m2 = Math.sin(er+d) / Math.cos(er+d);
    
    //補助線
    ctx.restore();
    ctx.beginPath();
    ctx.strokeStyle = '#999';
    ctx.moveTo(0,0);
    ctx.lineTo(px.cx,px.cx*m1);
    ctx.moveTo(0,0);
    ctx.lineTo(px.cx,px.cx*m2);
    ctx.stroke();
    ctx.restore();
}

function _dot(x,y) {
    ctx.beginPath();
    ctx.save();
    ctx.arc(x,y,3,0,360*Math.PI/180);
    ctx.fill();
    ctx.restore();
}

canvas.addEventListener('mousemove', onMouseMove, false);
function onMouseMove(e) {
    var x = e.clientX - px.cx, y = e.clientY - px.cy;
    if( y < m1 * x && y > m2 * x && ( Math.pow(x,2) + Math.pow(y,2) ) < 10000) {
        flg = true;
    } else {
        flg = false;
    }
    _draw();
    _dot(e.clientX,e.clientY);
    
    //(1,m1) (e.clientX,e.clientY)
    //log(Math.cos((e.clientX*1)+(e.clientY*m1)));
    // console.log(Math.atan2(y,x)*180/Math.PI);
    //log( Math.acos( ((1*x)+(m1*y))/(Math.sqrt(Math.pow(x,2)+Math.pow(y,2))*Math.sqrt(Math.pow(1,2)+Math.pow(m1,2))) ) * 180/Math.PI );
}

_draw();


</script>

    </body>
</html>
